<%= render partial: 'application/feature_detection' %>
<div class="mt-28">

  <div class="flex flex-col gap-4 max-w-xs">
    <fieldset class="fieldset bg-base-200 border-base-300 rounded-box border p-4">
      <legend class="fieldset-legend">Sign In with Passkey</legend>
      <%= form_with scope: :session, url: webauthn_session_path, local: false, id: "new-session",
      data: { controller: "new-session",
      action: "ajax:success->new-session#create ajax:error->new-session#error" } do |form| %>
        <div data-controller="textfield" data-target="new-session.usernameField">
          <%= form.text_field :username, class: "input mdc-text-field__input", placeholder: "Username", required: true, autocapitalize: "none", "aria-controls" => "username-helper-text" %>
        </div>

        <div class="mdc-text-field-helper-line">
          <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg">
          </div>
        </div>
        <%= form.submit "Sign in with Passkey", class: "btn btn-neutral mt-4 w-full" %>
      <% end %>

      <%= render partial: 'application/js_error' %>

      <%= link_to "Sign in with email", new_email_session_path, class: "btn btn-secondary w-full mt-3" %>
      <%= link_to 'Register Instead', new_webauthn_registration_path(return_to: session[:return_to]), class: "btn btn-primary mt-4" if session[:return_to] %>
      <%= link_to 'Register Instead', new_webauthn_registration_path, class: "btn btn-primary mt-2" unless session[:return_to] %>
    </fieldset>
  </div>

</div>